document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("currency-select");let r="USD",c=0,t=localStorage.getItem("currency")?.trim().toUpperCase();function a(t){var e=r.trim().toUpperCase();let o=t.trim().toUpperCase();document.cookie=`currency=${o}; path=/`,e&&o?e===o?(console.log("⚠️ Base and target currencies are the same. Skipping fetch."),document.querySelectorAll("[data-price-usd]").forEach(e=>{var t=parseFloat(e.getAttribute("data-price-usd").replace(",","."));isNaN(t)||(e.textContent="$"+t.toFixed(2))}),document.querySelectorAll("[data-url-eur][data-url-usd]").forEach(e=>{var t=e.getAttribute("data-url-usd");t&&e.setAttribute("href",t)})):(e=`/wp-json/currency/v1/rate?base=${e}&target=`+o,console.log("📡 Fetching currency rate:",e),fetch(e).then(e=>{if(!(404===e.status&&c<3)){if(e.ok)return e.json();throw new Error("API error: "+e.status)}c++,console.warn("❗ REST API not ready yet, retrying in 1s..."),setTimeout(()=>a(t),1e3)}).then(e=>{if(e&&e.rate){let r=parseFloat(e.rate),a="EUR"===o?"€":"$";document.querySelectorAll("[data-price-usd]").forEach(e=>{var t=e.getAttribute("data-price-usd").replace(",","."),t=parseFloat(t);isNaN(t)||(t=(t*r).toFixed(2),e.textContent=a+t)}),document.querySelectorAll("[data-url-eur][data-url-usd]").forEach(e=>{var t="USD"===o?e.getAttribute("data-url-usd"):e.getAttribute("data-url-eur");t&&e.setAttribute("href",t)}),c=0}else console.warn("⚠️ No rate returned from API.")}).catch(e=>{console.error("🚫 Currency API error:",e)})):console.error("❌ Missing base or target currency")}t&&["USD","EUR"].includes(t)||(t=r,localStorage.setItem("currency",r)),e&&(e.value=t),setTimeout(()=>a(t),300),e&&e.addEventListener("change",function(){var e=this.value.trim().toUpperCase();localStorage.setItem("currency",e),a(e)})});